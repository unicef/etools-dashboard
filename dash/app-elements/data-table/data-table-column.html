<link rel="import" href="../../../bower_components/polymer/polymer.html">

<dom-module id="data-table-column">

  <template>

    <style>

      :host {
        @apply(--layout-horizontal);
        @apply(--layout-center);
        height: 56px;
        font-size: 12px;
        color: var(--secondary-text-color);
        font-weight: bold;
        white-space: nowrap;
        @apply(--column-height);
      }

      :host([sortable]) {
        cursor: pointer;
      }
      :host(:not(:first-child)){
        padding-left: 12px;
      }

      #label {
        margin-right: 5px;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
      }

      #icon-wrapper, iron-icon {
        width: 16px;
        height: 16px;
        @apply(--icon-display);
      }

      #up, #down {
        display: none;
      }

      .group-wrapper {
        @apply(--layout-vertical);
        @apply(--layout-flex);
      }
      #label.is-group {
        @apply(--layout-horizontal);
        @apply(--layout-center);
        @apply(--layout-around-justified);
        padding-top: 10px;
        margin-right: 0;
      }
      .group-heading {
        border-bottom : 1px solid rgba(0, 0, 0, 0.12);
        padding-bottom: 10px;
        width: 100%;
        text-align: center;
        white-space: nowrap;
      }

      :host(:not([selected]):hover[sortable]) #up {
        display: block;
      }

      :host([selected]) #label,
      :host(:not([selected]):hover[sortable]) #label {
        color: var(--primary-text-color, rgba(0, 0, 0, 0.87));
      }

      :host([selected][direction="asc"]) #up {
        display: block;
      }

      :host([selected][direction="desc"]) #down {
        display: block;
      }

      :host(:not([selected])) iron-icon {
        color: var(--sort-icon-hover-color, rgba(0, 0, 0, 0.38));
      }

      :host([selected]) iron-icon {
        color: var(--sort-icon-color, rgba(0, 0, 0, 0.87));
      }

    </style>
    <div class="group-wrapper">
        <template is="dom-if" if="[[groupHeading]]">
          <span class="group-heading">[[groupHeading]]</span>
        </template>
        <span id="label">
          <slot></slot>
        </span>
    </div>

    <div id="icon-wrapper">
      <iron-icon id="up" icon="arrow-upward"></iron-icon>
      <iron-icon id="down" icon="arrow-downward"></iron-icon>
    </div>

  </template>

  <script>

    Polymer({

      is: 'data-table-column',

      properties: {

        selected: {
          type: Boolean,
          value: false,
          reflectToAttribute: true
        },

        field: {
          type: String,
        },

        direction: {
          type: String,
          reflectToAttribute: true
        },
        groupHeading: {
          type: String,
          observer: '_isGroup',
        },
      },

      listeners: {
        'tap': '_sort'
      },

      _sort: function() {
        if (!this.hasAttribute('sortable')) {
          return;
        }
        if (!this.selected || !this.direction) {
          this.set('selected', true);
          this.set('direction', 'asc');
        } else {
          this.set('direction', this.direction === 'asc' ? 'desc' : 'asc');
        }
        this.fire('sort-changed', {field: this.field, direction: this.direction});
      },
      _isGroup: function () {
         this.$.label.classList.add('is-group');
         this.customStyle['--column-height'] = 'height: auto';
         this.updateStyles();
      },
      attached: function () {
        if (!this.hasAttribute('sortable')) {
          this.customStyle['--icon-display'] = 'display: none';
          this.updateStyles();
        }
      }

    });

  </script>

</dom-module>
