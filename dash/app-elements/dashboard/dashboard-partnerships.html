<link rel="import" href="../../../bower_components/polymer/polymer.html">

<link rel="import" href="../../../styles/shared-styles.html">
<link rel="import" href="../../../styles/list-styles.html">
<link rel="import" href="../../../styles/page-layout-styles.html">
<link rel="import" href="../../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../../../styles/grid-layout-styles.html">
<link rel="import" href="../../../styles/custom-iconsets/dash-icons.html">

<link rel="import" href="../../app-config/etools-app-config.html">

<link rel="import" href="../data-table/data-table-header.html">
<link rel="import" href="../data-table/data-table-column.html">
<link rel="import" href="../data-table/data-table-row.html">
<link rel="import" href="../data-table/data-table-footer.html">

<link rel="import" href="../../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../../../bower_components/paper-material/paper-material.html">
<link rel="import" href="../../../bower_components/paper-tooltip/paper-tooltip.html">
<link rel="import" href="../../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../../bower_components/paper-menu/paper-menu.html">
<link rel="import" href="../../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../../bower_components/iron-icons/editor-icons.html">
<link rel="import"
      href="../../../bower_components/etools-searchable-multiselection-menu/etools-multi-selection-menu.html">
<link rel="import" href="../../../bower_components/etools-datepicker/etools-datepicker-button.html">
<link rel="import" href="../../../bower_components/etools-info-tooltip/etools-info-tooltip.html">

<link rel="import" href="../../app-behaviors/dropdown-behavior.html">
<link rel="import" href="../../app-behaviors/common-general-behavior.html">
<link rel="import" href="../../app-behaviors/list-filters-behavior.html">
<link rel="import" href="../../app-elements/static-common-data/redux-bahaviors/common-static-data-redux-bahavior.html">
<link rel="import" href="dashboard-data/partnership-data.html">
<dom-module id="dashboard-partnerships">

  <template>
    <style include="shared-styles list-styles grid-layout-styles iron-flex iron-flex-factors page-layout-styles">
      /* .wrap-tooltip {
        --paper-tooltip: {
          width: 30px;
          overflow: visible;
          white-space: wrap;
        }
      } */
      
      .by-type {
        padding: 0;
        @apply(--layout-horizontal);
      }

      span.title {
        color: var(--accent-color);
        font-weight: 500;
      }

      data-table-header data-table-column:not(:first-child),
      data-table-row span:not(:first-child) {
        box-sizing: border-box;
        padding-left: 8px;
      }

      data-table-row div[slot="row-data"] div:not(:first-child) span,
      data-table-header div data-table-column data-table-column {
        padding-right: 8px;
        justify-content: flex-end;
      }

      data-table-row div[slot="row-data"] div span {
        display: flex;
      }

      .right-align {
        text-align: right;
      }

       data-table-row span:nth-child(3) {
         overflow-y: auto;
      }

      div.sections{
        height: 48px;
        white-space: normal !important;
      }

      div.sections > span {
        vertical-align: middle;
        line-height: normal
      }
      
      div div span {
        height: 48px;
        align-items: center;
      }

      .blue-col {
        background-color: rgb(222, 242, 254);
        max-width: 100%;
      }

      .green-col {
        background-color: rgb(237, 247, 223);
        max-width: 100%;
      }

      .width-70 {
        max-width: 70px;
      }

      .justify-end {
        justify-content: flex-end;
      }

      .to-date {
        background-image: -webkit-linear-gradient(135deg, rgb(222, 242, 254) 50%, rgb(237, 247, 223) 50%);
        height: 48px;
        max-width: 48px;
      }
      
      .red-icon {
        fill: rgb(231, 66, 45);
      }

      .blue-icon {
        fill: rgb(26, 154, 250);
      }
    </style>
    <partnership-data 
        id="partnerships"
        filtered-partnerships="{{filteredPartnerships}}"
        fire-data-loaded
        active="[[active]]"
        total-results="{{totalResults}}"
        on-partnerships-loaded="_requiredDataLoaded"
        list-data-path="filteredPartnerships">
    </partnership-data>

    <paper-material class="list-panel listControls" elevation="1">

      <div class="wrap-controls">
        <paper-input id="query" type="search" autocomplete="off" value="{{qs}}" placeholder="Search"
                     always-float-label on-search="setQuery">
          <iron-icon icon="search" prefix></iron-icon>
        </paper-input>
        <template is="dom-repeat" items="[[selectedFilters]]" as="filter">
          <!-- dropdown filters  -->
          <template is="dom-if" if="[[filterTypeIs('esmm', filter.type)]]">
            <div class="filter esmm">
              <etools-multi-selection-menu
                  label="[[filter.filterName]]"
                  placeholder="&#8212;"
                  disabled$="[[!filter.selectionOptions.length]"
                  options="[[filter.selectionOptions]]"
                  option-value="[[filter.optionValue]]"
                  option-label="[[filter.optionLabel]]"
                  selected-values="[[filter.alreadySelected]]"
                  trigger-value-change-event
                  on-etools-selected-items-changed="esmmValueChanged"
                  data-filter-path$="[[filter.path]]">
              </etools-multi-selection-menu>
              <paper-icon-button 
                  suffix class="remove-field remove" icon="cancel"
                  on-tap="removeFilter"
                  data-filter-name$="[[filter.filterName]]"
                  data-reset-path$="[[filter.path]]">
              </paper-icon-button>
            </div>
          </template>
          <!-- date pickers -->
          <template is="dom-if" if="[[filterTypeIs('datepicker', filter.type)]]">
            <div class="filter">
              <paper-input
                  id$="datepicker_parent_[[filter.path]]"
                  label="[[filter.filterName]]"
                  value="[[prettyDate(filter.dateSelected)]]"
                  on-down="openDatePicker"
                  data-selector$="datepicker_[[filter.path]]">
                <etools-datepicker-button 
                    prefix
                    id$="datepicker_[[filter.path]]"
                    date="[[prepareDate(filter.dateSelected)]]"
                    format="D MMM YYYY"
                    parent-id$="datepicker_parent_[[filter.path]]"
                    data-filter-path$="[[filter.path]]"
                    on-date-has-changed="_notifyDateChanged"
                    no-init show-clear-btn fire-date-has-changed>
                </etools-datepicker-button>
              </paper-input>
              <paper-icon-button
                  suffix class="remove-field remove" icon="cancel"
                  on-tap="removeFilter"
                  data-filter-name$="[[filter.filterName]]"
                  data-reset-path$="[[filter.path]]">
              </paper-icon-button>
            </div>
          </template>
        </template>
      </div>
      <div class="fixed-controls">
        <div class="filters-divider"></div>
        <paper-menu-button id="filterMenu" dynamic-align>
          <paper-button class="button dropdown-trigger">
            <iron-icon icon="filter-list"></iron-icon>
            add filter
          </paper-button>
          <paper-menu class="dropdown-content">
            <template is="dom-repeat" items="[[availableListFilterOptions]]">
              <paper-item on-tap="selectFilter">[[item.filterName]]</paper-item>
            </template>
          </paper-menu>
        </paper-menu-button>
      </div>

    </paper-material>

    <paper-material id="list" elevation="1">
      <data-table-header no-collapse>
        <data-table-column class="col-5" group-heading="blank" transparent>
          <data-table-column class="col-4" sortable>
            IP Name<br>PD/SSFA Ref #
          </data-table-column>
          <data-table-column class="col-2">
            Section
          </data-table-column>
          <data-table-column class="col-2">
            Field Office
          </data-table-column>
          <data-table-column class="col-2">
            Status
          </data-table-column>
          <data-table-column class="col-2">
            Start Date<br>End Date
          </data-table-column>
        </data-table-column>
        <div class="col-7 layout horizontal">
          <data-table-column class="col-4" group-heading="PLANNED BUDGET">
            <data-table-column class="col-3 right-align">
              PD<br>Currency
            </data-table-column>
            <data-table-column class="col-5 right-align">
              UNICEF<br>Supplies
            </data-table-column>
            <data-table-column class="col-4 right-align">
              UNICEF<br>Cash
            </data-table-column>
          </data-table-column>
          <data-table-column class="col-5" group-heading="FUNDS RESERVED & DISBURSED">
            <data-table-column class="col-3 right-align">
              FR<br>Currency
            </data-table-column>
            <data-table-column class="col-5 right-align">
              FR<br>Amount
            </data-table-column>
            <data-table-column class="col-4 right-align">
              Actual<br>Disbursm.
            </data-table-column>
          </data-table-column>
          <data-table-column class="col-3" group-heading="blank" transparent>
            <data-table-column class="col-5 right-align">
              Disburs.<br>To Date
            </data-table-column>
            <data-table-column class="col-7 right-align">
              Days Since<br>Last PV
            </data-table-column>
          </data-table-column>
        </div>
      </data-table-header>

      <template is="dom-repeat" items="[[filteredPartnerships]]" as="row">
        <data-table-row no-collapse>
          <div slot="row-data">
            <div class="col-5 layout horizontal">
              <span class="col-data col-4">
                <a on-tap="goToPage" href="[[baseSite]]/pmp/partners/[[row.partner_id]]/details" app-name="pmp"
                  page="partners" id="[[row.partner_id]]/details"
                  class="title">
                  [[row.partner_name]]
                  <paper-tooltip fit-to-visible-bounds>[[row.partner_name]]</paper-tooltip>
                </a><br>
                <a on-tap="goToPage" href="[[baseSite]]/pmp/interventions/[[row.intervention_id]]/details" app-name="pmp"
                  page="interventions"
                  id="[[row.intervention_id]]/details" class="title">
                  [[row.number]]
                  <paper-tooltip fit-to-visible-bounds>[[row.number]]</paper-tooltip>
                </a>
              </span>
              <span class="col-data col-2">
                <div class="sections">
                  <span >
                    <template is="dom-repeat" items="{{commaSplit(row.sections)}}">
                      [[item]]<br>
                    </template>
                  </span>
                </div>
              </span>
              <span class="col-data col-2">
                <template is="dom-repeat" items="{{commaSplit(row.offices_names)}}">
                  [[item]]<br>
                </template>
              </span>
              <span class="col-data col-2">
                [[capitalizeWord(row.status)]]
              </span>
              <span class="col-data col-2 date">
                [[prettyDate(row.start)]] <br> [[prettyDate(row.end)]]
              </span>
            </div>
            <div class="col-7 layout horizontal">
              <div class="col-4 layout horizontal">
                <span class="col-data col-3 right-align">
                  [[row.budget_currency]]
                </span>
                <span class="col-data col-5 right-align">
                  [[currencyFormat(row.unicef_supplies)]]
                </span>
                <span class="col-data col-4 right-align blue-col">
                  [[currencyFormat(row.unicef_cash)]]
                </span>
              </div>
              <div class="col-5 layout horizontal">
                <span class="col-data col-3 right-align">
                  <iron-icon hidden="[[row.all_currencies_are_consistent]]" icon="dash-custom-icons:not-equal" class="blue-icon"></iron-icon>
                  <paper-tooltip hidden="[[row.all_currencies_are_consistent]]">
                    FR currency does not match PD currency.<br>
                    Disbursement to date % cannot calculate.
                  </paper-tooltip>
                  <iron-icon hidden="[[_checkAllCurrenciesConsistent(row.all_currencies_are_consistent, row.fr_currencies_are_consistent)]]" icon="dash-custom-icons:1+" class="blue-icon">
                  </iron-icon>
                  <paper-tooltip hidden="[[row.fr_currencies_are_consistent]]">
                    More than 1 FR currency is available. FR Amount<br>
                    and Actual Disbursements cannot be displayed.
                  </paper-tooltip>
                  [[row.fr_currency]]
                </span>
                <span class="col-data col-5 right-align">
                  <iron-icon hidden="[[_isEqual(row.unicef_cash, row.frs_total_frs_amt)]]" icon="dash-custom-icons:not-equal" class="red-icon">
                    [[_displayDisbursement(row.disbursement)]]
                  </iron-icon>
                  <paper-tooltip hidden="[[_isEqual(row.unicef_cash, row.frs_total_frs_amt)]]">
                    FR amount does not equal to planned UNICEF cash
                  </paper-tooltip>
                  [[currencyFormat(row.frs_total_frs_amt)]]
                </span>
                <span class="col-data col-4 right-align green-col">
                  <iron-icon hidden="[[row.fr_currencies_are_consistent]]" icon="dash-custom-icons:not-equal" class="blue-icon">
                  </iron-icon>
                  <paper-tooltip hidden="[[row.fr_currencies_are_consistent]]">
                    Disbursement currency does not match FR currency
                  </paper-tooltip>
                  [[_displayDisbursement(row.disbursement)]]
                </span>
              </div>
              <div class="col-3 layout horizontal justify-end">
                <span class="col-data col-5 right-align to-date">
                  [[_getDisbPercent(row.disbursement_percent)]]
                </span>
                <span class="col-data col-7 right-align width-70">
                  [[displayNonZero(row.days_last_pv)]]
                </span>
              </div>
            </div>
          </div>
        </data-table-row>
      </template>
      <data-table-footer
          page-size="[[pageSize]]"
          page-number="[[pageNumber]]"
          visible-range="{{visibleRange}}"
          on-page-size-changed="pageSizeChanged"
          filtered-total-results="[[totalResults]]"
          on-page-number-changed="pageNumberChanged">
      </data-table-footer>
    </paper-material>
  </template>

  <script>
    (function() {
      'use strict';

      Polymer({
        is: 'dashboard-partnerships',
        behaviors: [
          dashBehaviors.DropdownBehavior,
          dashBehaviors.EtoolsStaticCommonDataReduxBehavior,
          dashBehaviors.CommonGeneralBehavior,
          dashBehaviors.ListFiltersBehavior,
          etoolsAppConfig.globals
        ],
        observers: [
          '_updateUrl(qs, pageNumber, pageSize,' +
          'sortOrder, requiredDataLoaded, initComplete, selectedSectors, selectedOffices,' +
          'selectedStatuses, startAfterDate, endBeforeDate, startBeforeDate, endAfterDate)',
          '_initListFilters(sectors, statuses, offices)',
          '_init(active,sectors,statuses,offices)'
        ],
        listeners: {
          'sort-changed': 'sortOrderChanged',
        },

        properties: {
          filteredPartnerships: {
            type: Array,
            notify: true,
          },
          forceDataRefresh: {
            type: Boolean,
            value: false
          },
          requiredDataLoaded: {
            type: Boolean,
            value: false
          },
          initComplete: {
            type: Boolean,
            value: false,
          },
          debounceTime: {
            type: Number,
            value: 50
          },
          qs: {
            type: String
          },
          csvDownloadUrl: {
            type: String,
            notify: true
          },
          urlParams: {
            type: Object,
          },
          sectors: {
            type: Array,
            statePath: 'sectors'
          },
          statuses: {
            type: Array,
            statePath: 'statuses'
          },
          offices: {
            type: Array,
            statePath: 'offices'
          },
          selectedSectors: {
            type: Array,
            observer: '_filterChanged'
          },
          selectedOffices: {
            type: Array,
            observer: '_filterChanged'
          },
          selectedStatuses: {
            type: Array,
            observer: '_filterChanged'
          },
          startAfterDate: {
            type: String,
            observer: '_dateChanged'
          },
          startBeforeDate: {
            type: String,
            observer: '_dateChanged'
          },
          endBeforeDate: {
            type: String,
            observer: '_dateChanged'
          },
          endAfterDate: {
            type: String,
            observer: '_dateChanged'
          },
          params: {
            type: Array,
            value: function() { return [
              {
                qName: 'qs',
                propName: 'qs',
                xf: xs=> xs
              },
              {
                qName: 'sort',
                propName: 'sortOrder',
                xf: xs=> xs
              },
              {
                qName: 'sectors',
                propName: 'selectedSectors',
                xf: xs=> _.map(xs, 'value').join('|')
              },
              {
                qName: 'offices',
                propName: 'selectedOffices',
                xf: xs=> _.map(xs, 'name').join('|')
              },
              {
                qName: 'status',
                propName: 'selectedStatuses',
                xf: xs=> _.map(xs, 'value').join('|')
              },
              {
                qName: 'startAfter',
                propName: 'startAfterDate',
                xf: xs=> this.prettyDate(xs, 'YYYY-MM-DD')
              },
              {
                qName: 'endBefore',
                propName: 'endBeforeDate',
                xf: xs=> this.prettyDate(xs, 'YYYY-MM-DD')
              },
              {
                qName: 'startBefore',
                propName: 'startBeforeDate',
                xf: xs=> this.prettyDate(xs, 'YYYY-MM-DD')
              },
              {
                qName: 'endAfter',
                propName: 'endAfterDate',
                xf: xs=> this.prettyDate(xs, 'YYYY-MM-DD')
              },
    
            ];}
          }

        },

        _init: function(active, sectors, statuses, offices) {
          let params = this.urlParams;
          let staticLoaded = this._allHaveValues('sectors', 'statuses', 'offices');
          if (!active || !params || !staticLoaded) {
            return;
          }
          this.set('initComplete', false);
          this.set('qs', params.qs ? params.qs : '');
          this.set('pageNumber', params.page ? parseInt(params.page) : 1);
          this.set('pageSize', params.size ? parseInt(params.size) : 10);
          this.set('sortOrder', params.sort ? params.sort : 'asc');
          this.set('selectedSectors', params.sectors ? this._setSelectedSectors(params.sectors) : []);
          this.set('selectedOffices', params.offices ? this._setSelectedOffices(params.offices) : []);
          this.set('selectedStatuses', params.status ? this._setSelectedStatuses(params.status) : this._setSelectedStatuses('signed|active|ended|suspended|terminated'));
          this.set('startAfterDate', params.startAfter ? params.startAfter : '');
          this.set('endBeforeDate', params.endBefore ? params.endBefore : '');
          this.set('startBeforeDate', params.startBefore ? params.startBefore : '');
          this.set('endAfterDate', params.endAfter ? params.endAfter : '');
          this.set('initComplete', true);
          this._updateSelectedFiltersValues();
        },

        _initListFilters: function(sectors, statuses, offices) {
          this.debounce('init-list-filters', function() {
            this.initListFiltersData([
              {
                filterName: 'Section/Cluster',
                type: 'esmm',
                optionValue: 'value',
                optionLabel: 'label',
                selectionOptions: this.sectors,
                alreadySelected: [],
                path: 'selectedSectors'
              },
              {
                filterName: 'Field Office',
                type: 'esmm',
                optionValue: 'id',
                optionLabel: 'name',
                selectionOptions: this.offices,
                alreadySelected: [],
                path: 'selectedOffices'
              },
              {
                filterName: 'Status',
                type: 'esmm',
                optionValue: 'value',
                optionLabel: 'label',
                selectionOptions: this.statuses.slice(1),
                alreadySelected: [],
                path: 'selectedStatuses'
              },
              {
                filterName: 'Starts After',
                type: 'datepicker', // etools-datepicker
                path: 'startAfterDate',
                dateSelected: ''
              },
              {
                filterName: 'Ends Before',
                type: 'datepicker', // etools-datepicker
                path: 'endBeforeDate',
                dateSelected: ''
              },
              {
                filterName: 'Starts Before',
                type: 'datepicker', // etools-datepicker
                path: 'startBeforeDate',
                dateSelected: ''
              },
              {
                filterName: 'Ends After',
                type: 'datepicker', // etools-datepicker
                path: 'endAfterDate',
                dateSelected: ''
              }

            ]);
          }.bind(this), 100);
        },

        _updateSelectedFiltersValues: function() {
          this.debounce('updateShownFilters', ()=>{
        let filtersValues = [
              {
                filterName: 'Section/Cluster',
                selectedValue: _.map(this.selectedSectors, 'value')
              },
              {
                filterName: 'Field Office',
                selectedValue: _.map(this.selectedOffices, 'id')
              },
              {
                filterName: 'Status',
                selectedValue: _.map(this.selectedStatuses, 'value')
              },
              {
                filterName: 'Starts After',
                selectedValue: this.startAfterDate
              },
              {
                filterName: 'Starts Before',
                selectedValue: this.startBeforeDate
              },
              {
                filterName: 'Ends Before',
                selectedValue: this.endBeforeDate
              },
              {
                filterName: 'Ends After',
                selectedValue: this.endAfterDate
              }
            ];
            this.updateShownFilters(filtersValues);
          }, 200);
        },

        _updateUrl: function() {
          if (!this.initComplete || !this.requiredDataLoaded) {
            return;
          }
          this.set('csvDownloadUrl', this._buildCsvDownloadUrl());
          const qs = this._buildQueryString();
          if (qs !== null) {
            this.updateAppState('dashboard/partnerships', qs, true);
            if (this.requiredDataLoaded) {
              this._filterPartnershipsData();
            }
          } else {
            if (location.search === '') {
              this.updateAppState('dashboard/partnerships', qs, false);
            }
            if (this.forceDataRefresh && this.requiredDataLoaded) {
              this._filterPartnershipsData();
              this.set('forceDataRefresh', false);
            }
          }
        },
    
        _buildQueryString: function() {
         return this.params.reduce((acc, {qName, propName, xf})=>{
           return _.isEmpty(this[propName]) ? acc
          : `${acc}&${qName}=${xf(this[propName])}`;
          }, `page=${this.pageNumber}&size=${this.pageSize}`);
        },

        _buildCsvDownloadUrl: function() {
          return `${this.getEndpoint('cso_dashboard').url}?format=csv`;
        },

        _filterPartnershipsData: function() {
          this.$.partnerships.query({
            searchString: this.qs,
            sectors: _.map(this.selectedSectors, 'label'),
            offices: _.map(this.selectedOffices, 'name'),
            status: _.map(this.selectedStatuses, 'value'),
            startAfterDate: this.startAfterDate,
            endBeforeDate: this.endBeforeDate,
            startBeforeDate: this.startBeforeDate,
            endAfterDate: this.endAfterDate,
            order: this.sortOrder,
            pageSize: this.pageSize,
            pageNumber: this.pageNumber
          });
        },

        _notifyDateChanged: function(event) {
          this._filterDateHasChanged(event);
          this._updateSelectedFiltersValues();
        },

        _requiredDataLoaded: function(event) {
          event.stopImmediatePropagation();
          const listDataPath = Polymer.dom(event).localTarget.getAttribute('list-data-path');
          const list = this.get(listDataPath);

          if (typeof list === 'undefined' ||
            (Array.isArray(list) && list.length === 0)) {
            this.set('forceDataRefresh', true);
          }
          // recheck params to trigger agreements filtering
          this.set('initComplete', false);
          this.set('requiredDataLoaded', true);
          this._init(this.active);
        },

        _setSelectedOffices: function(officesStr) {
          let officesIdsArr = officesStr.split('|');
          if (!_.isEmpty(officesIdsArr)) {
            officesIdsArr = officesIdsArr.map(n=> parseInt(n, 10));
            return this.offices.filter(o=> officesIdsArr.includes(parseInt(o.id, 10)));
          }
          return [];
        },

        _setSelectedSectors: function(sectorsStr) {
          const sectorsArr = sectorsStr.split('|');
          if (!_.isEmpty(sectorsArr)) {
            const selectedSectors = this.sectors.filter(function(s) {
              return sectorsArr.indexOf(s.value) > -1;
            });
            return selectedSectors;
          }
          return [];
        },

        _setSelectedStatuses: function(statuses) {
          const statusesStrArr = statuses.split('|');
          if (_.isEmpty(this.statuses)) {
            return [];
          }
          return this.statuses.filter(function(status) {
            return statusesStrArr.indexOf(status.value) > -1;
          });
        },

        _getDisbPercent: function(perc) {
          return perc === '0.00' ? '0'
            : `${Number(perc).toFixed(0)}%`;
        },
        _filterChanged: function() {
          this.set('debounceTime', 200);
          this.set('pageNumber', 1);
        },
        pageSizeChanged: function(e) {
          this.set('debounceTime', 200);
          this.set('pageNumber', 1);
          this.set('pageSize', parseInt(e.detail.value));
        },
        pageNumberChanged: function(e) {
          this.set('debounceTime', 50);
          this.set('pageNumber', e.detail.value);
        },
        _dateChanged: function(date) {
          this.set('pageNumber', 1);
        },
        sortOrderChanged: function(e) {
          this.set('debounceTime', 150);
          this.set('sortOrder', e.detail.direction);
        },
        _displayDisbursement: function(val) {
          let nonZero = this.displayNonZero(val);
          return Number(nonZero) ? this.currencyFormat(nonZero) : nonZero;
        },
        _isEqual: function(first, second) {
          return first === second;
          // return true;
        },
        _checkAllCurrenciesConsistent: function(all_currencies_are_consistent, fr_currencies_are_consistent) {
          if (!fr_currencies_are_consistent && !all_currencies_are_consistent) {
            return true
          }
          if (fr_currencies_are_consistent) {
            return true
          }
          return false
        },
      });
    })();
  </script>
</dom-module>
