<link rel="import" href="../config/config.html">
<link rel="import" href="endpoints.html">
<link rel="import" href="../scripts/lodash.html">
<link rel="import" href="../scripts/ramda.html">

<script>
  'use strict';
  const { template } = _;
  const { isEmpty } = R;

  window.EtoolsDashboard = window.EtoolsDashboard || {};
  window.EtoolsDashboard.Mixins = window.EtoolsDashboard.Mixins || {};

  EtoolsDashboard.Mixins.Endpoints = Polymer.dedupingMixin(
    (superClass) => class extends superClass {

      getEndpoint(endpointName, data) {
        let endpoint = JSON.parse(JSON.stringify(EtoolsDashboard.Endpoints[endpointName]));
        if (endpoint && this.endpointHasTemplate(endpoint)) {
          endpoint.url = window.location.origin + template(endpoint.template)(data);
        } else {
          endpoint.url = EtoolsDashboard.Config.baseSite + endpoint.url;
        }
        return endpoint;
      }

      endpointHasTemplate(ep) {
        return ep.hasOwnProperty('template') && !isEmpty(ep.template)
      }

      getAllPermissions() {
        return etoolsAppConfig.permissions;
      }
    }
  );
</script>