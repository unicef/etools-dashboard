<!-- <link rel="import" href="../../../bower_components/etools-ajax/etools-ajax-request-mixin.html"> -->
<link rel="import" href="../config/config.html">
<!-- <link rel="import" href="../redux/etools-data-redux-store.html"> -->
<link rel="import" href="endpoints.html">

<script>
  'use strict';

  window.EtoolsDashboard = window.EtoolsDashboard || {};
  window.EtoolsDashboard.Mixins = window.EtoolsDashboard.Mixins || {};

  EtoolsDashboard.Mixins.Endpoints = Polymer.dedupingMixin(
    (superClass) => class extends EtoolsAjaxRequestMixin(EtoolsDashboard.Mixins.EtoolsDataReduxStore(superClass)) {
      
      getEndpoint(endpointName, data) {
        let endpoint = JSON.parse(JSON.stringify(etoolsDashboard.endpoints[endpointName]));
        if (endpoint && this.endpointHasTemplate(endpoint)) {
          // not sure exactly how to convert _.template to ramda
          endpoint.url = window.location.origin + _.template(endpoint.template)(data);
        } else {
          endpoint.url = this.baseSite + endpoint.url;
        }
        return endpoint;
      }

      endpointHasTemplate(ep) {
        return ep.hasOwnProperty('template') && !R.isEmpty(ep.template)
      }

      getAllPermissions() {
        return etoolsAppConfig.permissions;
      }
    }
  );
</script>